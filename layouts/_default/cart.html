{{ define "main" }}

<h2>Your Cart</h2>
<div id="cart-items"></div>
<div id="paypal-button-container"></div>

<script>
  // Retrieve cart items from localStorage
  const cart = JSON.parse(localStorage.getItem('cart')) || [];

  // Populate the cart display
  const cartContainer = document.getElementById('cart-items');
  let total = 0;

  if (cart.length > 0) {
    cart.forEach(item => {
      total += parseFloat(item.price);

      const cartItem = document.createElement('div');
      cartItem.innerHTML = `
        <img src="${item.image}" alt="${item.name}" style="width: 100px; height: auto;">
        <p>${item.name}</p>
        <p>Price: $${item.price}</p>
      `;
      cartContainer.appendChild(cartItem);
    });
  } else {
    cartContainer.innerHTML = '<p>Your cart is empty.</p>';
  }

  // PayPal Button
  paypal.Buttons({
    createOrder: function (data, actions) {
      return actions.order.create({
        purchase_units: [{
          amount: {
            value: total.toFixed(2) // Total cart value
          },
          items: cart.map(item => ({
            name: item.name,
            unit_amount: {
              currency_code: 'USD',
              value: item.price,
            },
            quantity: 1,
            category: 'PHYSICAL_GOODS',
            image_url: window.location.origin + item.image,
          })),
        }]
      });
    },
    onApprove: function (data, actions) {
      return actions.order.capture().then(function (details) {
        alert('Transaction completed by ' + details.payer.name.given_name);
        localStorage.removeItem('cart'); // Clear the cart
        window.location.href = '/success.html';
      });
    }
  }).render('#paypal-button-container');
</script>

{{ end }}
